<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Liga de Béisbol de Cartagena</title>
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <!-- HERO COMPACTO -->
  <header class="hero-compact" id="inicio">
    <div class="hero-inner">
      <img src="https://i.ibb.co/Bz7h7YK/Recurso-5-100.jpg" alt="Liga de Béisbol de Cartagena" class="hero-logo">
      <div class="hero-text">
        <h1 class="hero-title">Liga de Béisbol de Cartagena</h1>
        <p class="hero-subtitle">Gestión oficial del béisbol en Cartagena</p>
        <div class="hero-stats">
          <span class="stat-capsule">
            <strong class="stat-number" th:text="${temporada.equiposParticipantes.size()}">0</strong> Equipos
          </span>
          <span class="stat-capsule">
            <strong class="stat-number">2025</strong> Temporada
          </span>
        </div>
      </div>
    </div>
  </header>
  
  <!-- NAV -->
  
  <nav class="main-nav">
    <div class="nav-container">
      <a href="/temporadas-jugadores" class="nav-link">
        Jugadores
      </a>
      <a href="/listar-partidos" class="nav-link">
        Partidos
      </a>
	  <a href="/prediccion" class="nav-link">
	    Predicción
	  </a>

      <!-- BOTÓN DE INICIAR SESIÓN (solo si NO está loggeado) -->
      <a href="/admin" class="nav-link login-btn" 
         th:unless="${#authorization.expression('isAuthenticated()')}">
        Iniciar Sesión
      </a>

	  <!-- USUARIO AUTENTICADO -->
	  <div class="user-section" th:if="${#authorization.expression('isAuthenticated()')}">
	    <span class="welcome-msg"
	          th:if="${#authentication.principal instanceof T(org.springframework.security.oauth2.core.user.DefaultOAuth2User)}"
	          th:text="'Bienvenido, ' + ${#authentication.principal.attributes['name']} + '!'">
	    </span>

	    <span class="welcome-msg"
	          th:if="${#authentication.principal instanceof T(org.springframework.security.core.userdetails.User)}"
	          th:text="'Bienvenido, ' + ${#authentication.name} + '!'">
	    </span>

	    <!-- BOTÓN PANEL ADMIN (SOLO SI ES ADMIN) -->
	    <a href="/admin" class="nav-link admin-panel-btn"
	       th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
	      Panel Admin
	    </a>

	    <!-- CERRAR SESIÓN -->
	    <form th:action="@{/logout}" method="post" class="logout-form">
	      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	      <button type="submit" class="logout-btn">Cerrar sesión</button>
	    </form>
	  </div>
    </div>
  </nav>
  <main class="contenido" id="equipos">
	<div class="welcome-section">
	  <h2 class="welcome-title">¡Bienvenido!</h2>
	  <p class="welcome-subtitle">
		<h1>Consulta resultados, estadísticas y mantente al día con la liga.</h1>
	  </p>
	</div>
    <!-- SELECTOR TEMPORADA MEJORADO -->
    <div class="season-selector">
      <form method="get" action="/">
        <label for="temporadaSelect" class="season-label">Temporada Actual:</label>
        <div class="select-wrapper">
          <select name="id" id="temporadaSelect" class="season-select" onchange="this.form.submit()">
            <option th:each="temp : ${todasTemporadas}"
                    th:value="${temp.id}"
                    th:text="${temp.nombreTemporada + ' (' + temp.anio + ')'}"
                    th:selected="${temp.id == temporada.id}">
            </option>
          </select>
        </div>
      </form>
    </div>

    <!-- TABLA DE POSICIONES MEJORADA -->
    <div class="standings-table">
      <h3 class="table-title">Tabla de Posiciones</h3>
      <table class="teams-table">
        <thead>
          <tr>
            <th>Pos</th>
            <th>Equipo</th>
            <th>Ciudad</th>
            <th>G</th>
            <th>P</th>
            <th>%</th>
			<th>GB</th>
          </tr>
        </thead>
        <tbody>
			<tr th:each="equipo, stat : ${temporada.equiposParticipantes}"
			    th:if="${!#strings.equalsIgnoreCase(equipo.nombre, 'Agentes Libres')}">
            <td th:text="${stat.index + 1}" class="position">1</td>
            <td class="team-name">
              <strong th:text="${equipo.nombre}">Nombre</strong>
            </td>
            <td th:text="${equipo.ciudad}">Ciudad</td>
            <td th:text="${equipo.partidosGanados}" class="wins">0</td>
            <td th:text="${equipo.partidosPerdidos}" class="losses">0</td>
			<td th:with="
			        total=${equipo.partidosGanados + equipo.partidosPerdidos},
			        pct=${total == 0 ? 0.0 : (equipo.partidosGanados * 1.0) / total}"
			    th:text="${#numbers.formatDecimal(pct, 1, 3)}"
			    class="percentage">
			</td>
			<td th:with="
			        lider=${temporada.equiposParticipantes[0]},
			        gb=${((lider.partidosGanados - equipo.partidosGanados) 
			             + (equipo.partidosPerdidos - lider.partidosPerdidos)) / 2.0}
			     "
			     th:text="${stat.index == 0 ? '0.0' : gb}"
			>
			</td>

          </tr>
        </tbody>
      </table>
    </div>

    <!-- CALL TO ACTION PARA USUARIOS NO AUTENTICADOS -->
    <div class="cta-section" th:unless="${#authorization.expression('isAuthenticated()')}">
      <h3>¿Eres parte de la liga?</h3>
      <p>Accede a todas las funcionalidades del sistema de gestión</p>
      <a href="/admin" class="cta-button">Iniciar Sesión</a>
    </div>

    <!-- VIDEO DESTACADO -->
    <section class="video-destacado">
      <h3>Jugada Destacada</h3>
      <div class="video-container">
        <iframe src="https://www.youtube.com/embed/Kgu70_FczcA" frameborder="0" allowfullscreen></iframe>
      </div>
    </section>

    <!-- DESCRIPCIÓN DE LA LIGA -->
    <section class="descripcion-liga" id="descripcion">
      <h3>¿Qué es la Liga de Béisbol de Cartagena?</h3>
      <p>
        La <strong>Liga de Béisbol de Cartagena</strong> es la organización oficial encargada de promover y regular el béisbol en el departamento de Bolívar, Colombia. Con sede en Cartagena, trabaja en la formación de jugadores desde categorías infantiles hasta mayores, organizando torneos locales y representando a la región en competencias nacionales. Es una plataforma clave para el desarrollo del talento beisbolero en la región Caribe, y una aliada de la Federación Colombiana de Béisbol en eventos deportivos de alto nivel.
      </p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Liga de Béisbol de Cartagena - Todos los derechos reservados</p>
  </footer>
</body>
</html>